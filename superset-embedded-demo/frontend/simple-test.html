<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>简单测试</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        #container { width: 100%; height: 800px; background: white; border: 1px solid #ddd; }
        .info { background: #e6f7ff; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .config { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Dashboard 嵌入测试（简化版）</h1>

    <div class="info">
        <strong>配置信息：</strong>
        <div class="config">后端: <span id="backend-url"></span></div>
        <div class="config">Superset: <span id="superset-url"></span></div>
        <div class="config">Embedded UUID: <span id="embedded-id"></span></div>
        <div class="config">Dashboard UUID: <span id="dashboard-id"></span></div>
    </div>

    <div id="container">加载中...</div>

    <script src="https://unpkg.com/@superset-ui/embedded-sdk@latest/bundle/index.js"></script>
    <script>
        // 配置
        const BACKEND = 'http://localhost:3001';
        const SUPERSET = 'http://localhost:8088';
        const EMBEDDED_ID = '51c5173a-ae1d-4038-b417-22a72c15bb48';
        const DASHBOARD_ID = '6d106529-9f27-4df9-9c9e-50e036a67559';

        // 显示配置
        document.getElementById('backend-url').textContent = BACKEND;
        document.getElementById('superset-url').textContent = SUPERSET;
        document.getElementById('embedded-id').textContent = EMBEDDED_ID;
        document.getElementById('dashboard-id').textContent = DASHBOARD_ID;

        console.log('=== 开始加载 ===');
        console.log('后端:', BACKEND);
        console.log('Superset:', SUPERSET);
        console.log('Embedded UUID:', EMBEDDED_ID);

        // 嵌入
        supersetEmbeddedSdk.embedDashboard({
            id: EMBEDDED_ID,
            supersetDomain: SUPERSET,
            mountPoint: document.getElementById('container'),
            fetchGuestToken: async () => {
                console.log('获取 guest token...');
                const res = await fetch(`${BACKEND}/api/guest-token`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({dashboardId: DASHBOARD_ID, username: 'test'})
                });
                const data = await res.json();
                console.log('Token 获取成功');
                return data.token;
            },
            debug: true
        }).then(() => {
            console.log('=== 加载成功 ===');
        }).catch(err => {
            console.error('=== 加载失败 ===', err);
            document.getElementById('container').innerHTML =
                '<div style="padding:20px;color:red;">错误: ' + err.message + '</div>';
        });
    </script>
</body>
</html>
