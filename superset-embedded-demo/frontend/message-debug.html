<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Debug Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #00ff00;
        }
        .log {
            background: #000;
            border: 1px solid #00ff00;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #333;
        }
        .timestamp {
            color: #888;
        }
        .type-ai {
            color: #00ffff;
            font-weight: bold;
        }
        .type-other {
            color: #ffff00;
        }
        h1 {
            color: #00ff00;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }
        button:hover {
            background: #00dd00;
        }
        .test-button {
            background: #ff9900;
        }
        .test-button:hover {
            background: #dd7700;
        }
    </style>
</head>
<body>
    <h1>ğŸ” AI Button Message Debug Console</h1>
    <p>è¿™ä¸ªé¡µé¢ä¼šæ•è·æ‰€æœ‰ postMessage æ¶ˆæ¯ï¼Œå¸®åŠ©è°ƒè¯•</p>

    <div>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <button class="test-button" onclick="sendTestMessage()">å‘é€æµ‹è¯•æ¶ˆæ¯</button>
    </div>

    <h2>ğŸ“¨ æ¶ˆæ¯æ—¥å¿—:</h2>
    <div class="log" id="log"></div>

    <h2>ğŸ“Š ç»Ÿè®¡:</h2>
    <div class="log">
        <div>æ€»æ¶ˆæ¯æ•°: <span id="total">0</span></div>
        <div>AI æ¶ˆæ¯æ•°: <span id="ai-count">0</span></div>
        <div>å…¶ä»–æ¶ˆæ¯æ•°: <span id="other-count">0</span></div>
    </div>

    <script>
        let totalCount = 0;
        let aiCount = 0;
        let otherCount = 0;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';

            const now = new Date();
            const timestamp = now.toLocaleTimeString() + '.' + now.getMilliseconds();

            entry.innerHTML = `
                <span class="timestamp">[${timestamp}]</span>
                <span class="${type}">${message}</span>
            `;

            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStats() {
            document.getElementById('total').textContent = totalCount;
            document.getElementById('ai-count').textContent = aiCount;
            document.getElementById('other-count').textContent = otherCount;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            totalCount = 0;
            aiCount = 0;
            otherCount = 0;
            updateStats();
            log('æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        function sendTestMessage() {
            const testMessage = {
                type: 'ai-question',
                payload: 'This is a test message from debug page'
            };
            window.postMessage(testMessage, '*');
            log('âœ… å‘é€æµ‹è¯•æ¶ˆæ¯: ' + JSON.stringify(testMessage), 'type-ai');
        }

        // ç›‘å¬æ‰€æœ‰ postMessage
        window.addEventListener('message', (event) => {
            totalCount++;

            const origin = event.origin || 'same-origin';
            const data = event.data;

            log(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`, 'info');
            log(`ğŸ“ Origin: ${origin}`, 'info');
            log(`ğŸ“¦ Data Type: ${typeof data}`, 'info');

            if (data && typeof data === 'object') {
                log(`ğŸ”‘ Keys: ${Object.keys(data).join(', ')}`, 'info');

                if (data.type === 'ai-question') {
                    aiCount++;
                    log(`âœ… AI-QUESTION DETECTED!`, 'type-ai');
                    log(`ğŸ’¬ Payload: ${data.payload}`, 'type-ai');
                } else {
                    otherCount++;
                    log(`â„¹ï¸ Type: ${data.type || 'undefined'}`, 'type-other');
                }

                log(`ğŸ“„ Full Data: ${JSON.stringify(data, null, 2)}`, 'info');
            } else {
                otherCount++;
                log(`ğŸ“„ Data: ${data}`, 'type-other');
            }

            updateStats();
        }, true); // ä½¿ç”¨æ•è·é˜¶æ®µ

        // é¡µé¢åŠ è½½å®Œæˆ
        log('ğŸš€ Debug Console å·²å¯åŠ¨ï¼Œæ­£åœ¨ç›‘å¬æ‰€æœ‰ postMessage...', 'type-ai');
        log('ğŸ’¡ è¯·åœ¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µæ‰“å¼€ ai-button-demo.html å¹¶ç‚¹å‡» "Ask AI"', 'info');
        log('ğŸ’¡ æˆ–è€…ç›´æ¥åœ¨è¿™ä¸ªé¡µé¢åµŒå…¥ Superset Dashboard è¿›è¡Œæµ‹è¯•', 'info');
    </script>
</body>
</html>
